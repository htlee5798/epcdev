<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMWEB0140">

	<typeAlias alias="resultClass" type="lcn.module.common.util.HashBox" />
	<typeAlias alias="paramClass" type="lcn.module.common.util.HashBox" />
	<typeAlias alias="NEDMWEB0140VO"
		type="com.lottemart.epc.edi.weborder.model.NEDMWEB0140VO" />

<!-- ssssssssssssss -->
<!--반품 목록 조회 -->
	<select id="EDI_RETURN_SELECT_03" parameterClass="NEDMWEB0140VO"
		resultClass="int">
		/*NEDMWEB0140.EDI_RETURN_SELECT_03*/
		SELECT COUNT(*) FROM (
		SELECT M1.RRL_REQ_NO
		,M1.PROD_CD
		,M1.SRCMK_CD
		,M1.PROD_NM
		,S1.STR_NM
		,M1.ORD_IPSU
		,M1.ORD_UNIT
		,M1.STD_SALE_PRC
		,M1.STD_BUY_PRC
		,M1.RRL_QTY
		,(M1.STD_SALE_PRC * RRL_QTY) AS STD_PROD_PRC
		,M1.REG_STS_CD
		,S2.CD_NM REG_STS_CD_NM
		FROM TPC_PO_RRL_PROD M1
		LEFT OUTER JOIN STORE S1
		ON M1.STR_CD = S1.STR_CD
		LEFT OUTER JOIN TPC_CODE S2
		ON S2.MAJOR_CD = 'WPO09'
		AND M1.REG_STS_CD = S2.MINOR_CD
		WHERE M1.RRL_DY = #rrlDy#
		AND M1.REG_STS_CD <![CDATA[<>]]>
		'0'
		<isNotEmpty property="venCd" prepend="AND">
			M1.VEN_CD = #venCd#
		</isNotEmpty>
		<isNotEmpty property="areaCd" prepend="AND">
			S1.AREA_FG = #areaCd#
		</isNotEmpty>
		<isNotEmpty property="strCd" prepend="AND">
			M1.STR_CD = #strCd#
		</isNotEmpty>
		<isNotEmpty property="prodCd" prepend="AND">
			M1.PROD_CD =#prodCd#
		</isNotEmpty>
		<isEqual property="regStsfg" prepend="AND" compareValue="2">
			M1.REG_STS_CD = '1'
		</isEqual>
		<isEqual property="regStsfg" prepend="AND" compareValue="3">
			M1.REG_STS_CD <![CDATA[<>]]>
			'1'
		</isEqual>
		ORDER BY S1.STR_NM, M1.PROD_CD )
	</select>
	
	<!--반품등록 전체 현황 -->
	<!--반품 목록 조회 EDI_RETURN_SELECT_01 -->
	<resultMap id="EDI_RETURN_SELECT_01Map" class="NEDMWEB0140VO">
		<result property="rrlReqNo" column="RRL_REQ_NO" />	<!-- 반품등록번호 -->
		<result property="prodCd" column="PROD_CD" />	<!-- 상품코드 -->
		<result property="srcmkCd" column="SRCMK_CD" />	<!-- 판매코드 -->
		<result property="prodNm" column="PROD_NM" />	<!-- 상품명 -->
		<result property="strCd" column="STR_CD" />	<!-- 점포코드 -->
		<result property="strNm" column="STR_NM" />	<!-- 점포명 -->
		<result property="prodStd" column="PROD_STD" />	<!-- 상품규격 -->
		<result property="ordIpsu" column="ORD_IPSU" />	<!-- 반품입수 -->
		<result property="ordUnit" column="ORD_UNIT" />	<!-- 단위 -->
		<result property="stdSalePrc" column="STD_SALE_PRC" />	<!-- 매가-EDI -->
		<result property="stdBuyPrc" column="STD_BUY_PRC" />	<!-- 원가-EID -->
		<result property="rrlQty" column="RRL_QTY" />	<!-- 반품수량 -->
		<result property="rrlStkQty" column="RRL_STK_QTY" />	<!-- 재고수량 -->
		<result property="stdProdPrc" column="STD_PROD_PRC" />	<!-- 반품환산금액(수량*매가) -->
		<result property="regStsCd" column="REG_STS_CD" />	<!-- 일괄등록상태코드 -->
		<result property="regStsCdNm" column="REG_STS_CD_NM" />	<!-- 일괄등록상태명칭 -->
		<result property="regStsCdDetail" column="REG_STS_CD_DETAIL" />	<!-- 일괄등록상태상세내용 -->
	</resultMap>

	<!--반품 목록 조회 -->
	<select id="EDI_RETURN_SELECT_01" parameterClass="NEDMWEB0140VO"
		resultMap="EDI_RETURN_SELECT_01Map">
		/*NEDMWEB0140.EDI_RETURN_SELECT_01*/
		SELECT *
		FROM ( SELECT ROWNUM RNUM , A.* FROM (
		SELECT M1.RRL_REQ_NO
		,M1.PROD_CD
		,M1.SRCMK_CD
		,M1.PROD_NM
		,M1.STR_CD
		,S1.STR_NM
		,M1.PROD_STD
		,M1.ORD_IPSU
		,M1.ORD_UNIT
		,M1.STD_SALE_PRC
		,M1.STD_BUY_PRC
		,M1.RRL_QTY
		,NVL(M1.RRL_STK_QTY, 0 ) AS RRL_STK_QTY
		,(M1.STD_BUY_PRC * RRL_QTY) AS STD_PROD_PRC
		,M1.REG_STS_CD
		,S2.CD_NM REG_STS_CD_NM
		,S2.CD_DESC REG_STS_CD_DETAIL
		FROM TPC_PO_RRL_PROD M1
		LEFT OUTER JOIN STORE S1
		ON M1.STR_CD = S1.STR_CD
		LEFT OUTER JOIN TPC_CODE S2
		ON S2.MAJOR_CD = 'WPO09'
		AND M1.REG_STS_CD = S2.MINOR_CD
		WHERE M1.RRL_DY = #rrlDy#
		AND M1.REG_STS_CD <![CDATA[<>]]>
		'0'
		<isNotEmpty property="venCd" prepend="AND">
			M1.VEN_CD = #venCd#
		</isNotEmpty>
		<isNotEmpty property="areaCd" prepend="AND">
			S1.AREA_FG = #areaCd#
		</isNotEmpty>
		<isNotEmpty property="strCd" prepend="AND">
			M1.STR_CD = #strCd#
		</isNotEmpty>
		<isNotEmpty property="prodCd" prepend="AND">
			M1.PROD_CD = #prodCd#
		</isNotEmpty>
		<isEqual property="regStsfg" prepend="AND" compareValue="2">
			M1.REG_STS_CD = '1'
		</isEqual>
		<isEqual property="regStsfg" prepend="AND" compareValue="3">
			M1.REG_STS_CD <![CDATA[<>]]>
			'1'
		</isEqual>
		ORDER BY S1.STR_NM, M1.PROD_CD) A) A
		WHERE RNUM BETWEEN #startRowNo# AND #endRowNo#
	</select>

	<!--반품 합계정보 조회 -->
	<!-- 반품 합계정보 조회 EDI_RETURN_PROD_SELECT_01 -->
	<resultMap id="EDI_RETURN_SELECT_02Map" class="NEDMWEB0140VO">
		<result property="strCdCnt" column="STR_CD_CNT" />	<!-- 등록점수 -->
		<result property="rrlTotProdQtySum" column="RRL_TOT_PROD_QTY_SUM" />  <!-- 전체상품수 -->
		<result property="rrlTotQtySum" column="RRL_TOT_QTY_SUM" />	<!-- 반품전체전수량 -->
		<result property="rrlTotPrcSum" column="RRL_TOT_PRC_SUM" />  <!-- 반품전체금액 -->
	</resultMap>
	<select id="EDI_RETURN_SELECT_02" parameterClass="NEDMWEB0140VO"
		resultMap="EDI_RETURN_SELECT_02Map">
		/*PEDMWEB0005.EDI_RETURN_SELECT_02*/
		SELECT STR_CD_CNT
		,RRL_TOT_PROD_QTY_SUM
		,NVL(RRL_TOT_QTY_SUM,'0') RRL_TOT_QTY_SUM
		,NVL(RRL_TOT_PRC_SUM,'0') RRL_TOT_PRC_SUM
		FROM ( SELECT COUNT(MAX(RRL_REQ_NO)) STR_CD_CNT
		FROM TPC_PO_RRL_PROD M1
		LEFT OUTER JOIN STORE S1
		ON M1.STR_CD = S1.STR_CD
		WHERE M1.RRL_DY = #rrlDy#
		AND M1.REG_STS_CD <![CDATA[<>]]>
		'0'
		<isNotEmpty property="venCd" prepend="AND">
			M1.VEN_CD = #venCd#
		</isNotEmpty>
		<isNotEmpty property="areaCd" prepend="AND">
			S1.AREA_FG = #areaCd#
		</isNotEmpty>
		<isNotEmpty property="strCd" prepend="AND">
			M1.STR_CD = #strCd#
		</isNotEmpty>
		<isNotEmpty property="prodCd" prepend="AND">
			M1.PROD_CD =#prodCd#
		</isNotEmpty>

		<isEqual property="regStsfg" prepend="AND" compareValue="2">
			M1.REG_STS_CD = '1'
		</isEqual>
		<isEqual property="regStsfg" prepend="AND" compareValue="3">
			M1.REG_STS_CD <![CDATA[<>]]>
			'1'
		</isEqual>
		GROUP BY M1.RRL_REQ_NO ) T1
		,(SELECT COUNT(MAX(PROD_CD)) RRL_TOT_PROD_QTY_SUM
		FROM TPC_PO_RRL_PROD M1
		LEFT OUTER JOIN STORE S1
		ON M1.STR_CD = S1.STR_CD
		WHERE M1.RRL_DY = #rrlDy#
		AND M1.REG_STS_CD <![CDATA[<>]]>
		'0'
		<isNotEmpty property="venCd" prepend="AND">
			M1.VEN_CD = #venCd#
		</isNotEmpty>
		<isNotEmpty property="areaCd" prepend="AND">
			S1.AREA_FG = #areaCd#
		</isNotEmpty>
		<isNotEmpty property="strCd" prepend="AND">
			M1.STR_CD = #strCd#
		</isNotEmpty>
		<isNotEmpty property="prodCd" prepend="AND">
			M1.PROD_CD =#prodCd#
		</isNotEmpty>

		<isEqual property="regStsfg" prepend="AND" compareValue="2">
			M1.REG_STS_CD = '1'
		</isEqual>
		<isEqual property="regStsfg" prepend="AND" compareValue="3">
			M1.REG_STS_CD <![CDATA[<>]]>
			'1'
		</isEqual>
		GROUP BY M1.PROD_CD ) T2
		,(
		SELECT SUM(RRL_QTY) RRL_TOT_QTY_SUM
		,SUM(STD_SALE_PRC*RRL_QTY) RRL_TOT_PRC_SUM
		FROM TPC_PO_RRL_PROD M1
		LEFT OUTER JOIN STORE S1
		ON M1.STR_CD = S1.STR_CD
		WHERE M1.RRL_DY = #rrlDy#
		AND M1.REG_STS_CD <![CDATA[<>]]>
		'0'
		<isNotEmpty property="venCd" prepend="AND">
			M1.VEN_CD = #venCd#
		</isNotEmpty>
		<isNotEmpty property="areaCd" prepend="AND">
			S1.AREA_FG = #areaCd#
		</isNotEmpty>
		<isNotEmpty property="strCd" prepend="AND">
			M1.STR_CD = #strCd#
		</isNotEmpty>
		<isNotEmpty property="prodCd" prepend="AND">
			M1.PROD_CD =#prodCd#
		</isNotEmpty>
		<isEqual property="regStsfg" prepend="AND" compareValue="2">
			M1.REG_STS_CD = '1'
		</isEqual>
		<isEqual property="regStsfg" prepend="AND" compareValue="3">
			M1.REG_STS_CD <![CDATA[<>]]>
			'1'
		</isEqual>
		) T3

	</select>

</sqlMap>
