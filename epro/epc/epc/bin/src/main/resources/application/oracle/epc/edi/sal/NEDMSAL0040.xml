<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMSAL0040">

	<typeAlias alias="resultClass"	type="lcn.module.common.util.HashBox" />
	<typeAlias alias="paramClass"	type="lcn.module.common.util.HashBox" />
	<typeAlias alias="nedmsal0040" type="com.lottemart.epc.edi.sale.model.NEDMSAL0040VO" />

	<resultMap id="nedmsal0040ProductDetailMap" class="nedmsal0040">
		<result property="strNm" 	   column="STR_NM" />
		<result property="strCd" 	   column="STR_CD" />
		<result property="prodCd" 	   column="PROD_CD" />
		<result property="prodNm" 	   column="PROD_NM" />
		<result property="saleQty" 	   column="SALE_QTY" />
		<result property="saleSaleAmt"  column="SALE_SALE_AMT" />
		<result property="srcmkCd" 	   column="SRCMK_CD" />
	</resultMap>
	
	<!-- 상품상세 -->
	<select id="TSC_PRODUCT_DETAIL-SELECT01" parameterClass="nedmsal0040" resultMap="nedmsal0040ProductDetailMap">
	/* NEDMSAL0040.TSC_PRODUCT_DETAIL-SELECT01 */
		SELECT 	  BB.STR_NM  
		         ,AA.STR_CD
		         ,AA.PROD_CD
		         ,AA.PROD_NM 
		         ,AA.SALE_QTY 
		         ,AA.SALE_SALE_AMT
		         ,AA.SRCMK_CD
		FROM (
		SELECT 		
			  	<isNotEmpty  property="searchStoreAl" >
					<isNotEmpty  property="searchProductVal" > 
						 /*+  index(A IX_PC_DY_STK_05) */			 
					</isNotEmpty>		 
				</isNotEmpty> 
				 
		       <isNotEmpty  property="searchProductVal" >		 
				   	<isEmpty  property="searchStoreAl" >
					 	/*+  index(A IX_PC_DY_STK_05) */ 
		       		</isEmpty>			 
		       </isNotEmpty>		 
			   <isNotEmpty  property="searchStoreAl" >
	  		   		<isEmpty  property="searchProductVal" >
				 		/*+  index(A IX_PC_DY_STK_04) */ 
			   		</isEmpty>
	         	</isNotEmpty>	    
				A.STR_CD
		       ,A.PROD_CD
		       ,MAX(A.PROD_NM) AS PROD_NM 
		       ,SUM(A.SALE_QTY) AS SALE_QTY 
		       ,SUM(A.SALE_SALE_AMT) AS SALE_SALE_AMT
		       ,A.SRCMK_CD
		FROM  TPC_DY_STK_NEW01 A 
		
		WHERE STK_DY BETWEEN replace(#srchStartDate#,'-','') and replace(#srchEndDate#,'-','')
		<isEmpty property="searchEntpCd">
			 <isNotEmpty  property="venCds"  prepend="AND"> 
		      <iterate prepend="A.VEN_CD IN " property="venCds" open="(" close=")" conjunction=","> 
		        #venCds[]# 
		      </iterate> 
		    </isNotEmpty>
		</isEmpty>
		      
			   
			   <isNotEmpty  property="searchEntpCd"  prepend="AND"> 
			    	A.VEN_CD = #searchEntpCd#
			   </isNotEmpty>		    
		
		       <isNotEmpty property="searchStoreAl"  prepend="AND"> 
			     <iterate prepend="A.STR_CD IN " property="searchStoreAl" open="(" close=")" conjunction=","> 
			       #searchStoreAl[]# 
			     </iterate> 
			   </isNotEmpty>
			    
			   <isNotEmpty  property="searchProductVal"  prepend="AND"> 
			    	A.PROD_CD = #searchProductVal#
			   </isNotEmpty>
			   
	
	   GROUP BY A.STR_CD, A.PROD_CD, A.SRCMK_CD 
	   ) AA  INNER JOIN  store BB
	  ON AA.STR_CD=BB.STR_CD
	   ORDER BY AA.STR_CD 
	</select>

</sqlMap>
