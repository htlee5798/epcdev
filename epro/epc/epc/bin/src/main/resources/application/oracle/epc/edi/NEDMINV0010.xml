<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMINV0010">

	<typeAlias alias="resultClass"	type="lcn.module.common.util.HashBox" />
	<typeAlias alias="paramClass"	type="lcn.module.common.util.HashBox" />
	<typeAlias alias="nedminv0010VO" type="com.lottemart.epc.edi.inventory.model.NEDMINV0010VO" />
	
	<resultMap id="nedminv0010ListMap"    class="nedminv0010VO">                                         	
		<result column="STR_CD" 				property="strCd"             />		<!-- // 점포코드     		-->
		<result column="STR_NM" 				property="strNm"             />	    <!-- // 점포명       		-->
		<result column="BUY_SALE_AMT" 			property="buySaleAmt"        />     <!-- // 매입금액     		-->
		<result column="RTN_SALE_AMT" 			property="rtnSaleAmt"        />     <!-- // 반품금액     		-->
		<result column="STRIO_SALE_AMT" 		property="strioSaleAmt"      />     <!-- // 점출입금액   		-->
		<result column="SALE_PRC_UPDOWN_AMT" 	property="salePrcUpdownAmt"  />     <!-- // 매가인상하금액	-->
		<result column="SALE_SALE_AMT" 			property="saleSaleAmt"       />     <!-- // 매출금액     		-->
		<result column="BUY_QTY" 				property="buyQty"            />     <!-- // 매입수량     		-->
		<result column="RTN_QTY" 				property="rtnQty"            />     <!-- // 반품수량     		-->
		<result column="STRIO_QTY" 				property="strioQty"          />     <!-- // 점출입수량   		-->
		<result column="SALE_QTY" 				property="saleQty"           />     <!-- // 매출수량     		-->
		<result column="STK_ADJ_SALE_AMT" 		property="stkAdjSaleAmt"     />     <!--                 	-->
		<result column="STK_ADJ_QTY" 			property="stkAdjQty"         />     <!--                 	-->
		<result column="BOOK_FWD_SALE" 			property="bookFwdSale"       />     <!-- // 기초재고금액 		-->
		<result column="BOOK_FWD_QTY" 			property="bookFwdQty"        />     <!-- // 기초재고 수량		-->
		<result column="FINAL_AMT" 				property="finalAmt"       	 />     <!-- // 기말금액 		-->
		<result column="FINAL_QTY" 				property="finalQty"        	 />     <!-- // 기말수량		-->
	</resultMap>
	
	<!-- 현재고(점포) -->	
	<select id="TSC_STORE-SELECT01" parameterClass="nedminv0010VO" resultMap="nedminv0010ListMap">
		/* NEDMINV0010.TSC_STORE-SELECT01*/
		  SELECT 
		    MM.STR_CD
		   , C.STR_NM
		   , NVL(BUY_SALE_AMT,0) AS BUY_SALE_AMT
		   , NVL(RTN_SALE_AMT,0) AS RTN_SALE_AMT
		   , NVL(STRIO_SALE_AMT,0) AS STRIO_SALE_AMT
		   , NVL(SALE_PRC_UPDOWN_AMT,0) AS SALE_PRC_UPDOWN_AMT
		   , NVL(SALE_SALE_AMT,0) AS SALE_SALE_AMT
		   , NVL(BUY_QTY,0) AS BUY_QTY
		   , NVL(RTN_QTY,0) AS RTN_QTY
		   , NVL(STRIO_QTY,0) AS STRIO_QTY
		   , NVL(SALE_QTY,0) AS SALE_QTY
		   , NVL(STK_ADJ_SALE_AMT,0) AS STK_ADJ_SALE_AMT
		   , NVL(STK_ADJ_QTY,0) AS STK_ADJ_QTY
		   , NVL(BOOK_FWD_SALE,0) AS BOOK_FWD_SALE
		   , NVL(BOOK_FWD_QTY,0) AS BOOK_FWD_QTY
		   , NVL(FINAL_AMT,0) AS FINAL_AMT
		   , NVL(FINAL_QTY,0) AS FINAL_QTY
		  FROM
		  (
		   SELECT 
		   <isNotEmpty  property="srchStoreVal" >
						<isNotEmpty  property="srchProductVal" >
							/*+  index(A IX_PC_MM_FWD_STK_NEW01_02) */
						</isNotEmpty>
					</isNotEmpty>
				
					<isNotEmpty  property="srchProductVal" >
						<isEmpty  property="srchStoreVal" >
							/*+  index(A IX_PC_MM_FWD_STK_NEW01_02) */
						</isEmpty>
					</isNotEmpty>
					<isNotEmpty  property="srchStoreVal" >
						<isEmpty  property="srchProductVal" >
							/*+  index(A IX_PC_MM_FWD_STK_NEW01_03) */
						</isEmpty>
					</isNotEmpty>
		   STR_CD
		   , SUM(NVL(BUY_SALE_AMT,0)) AS BUY_SALE_AMT
		    , SUM(NVL(RTN_SALE_AMT,0)) AS RTN_SALE_AMT
		    , SUM(NVL(STRI_SALE_AMT,0) - NVL(STRO_SALE_AMT,0)) AS STRIO_SALE_AMT
		    , SUM(NVL(SALE_PRC_UP_AMT,0) - NVL(SALE_PRC_DOWN_AMT,0)) AS SALE_PRC_UPDOWN_AMT
		    , SUM(NVL(SALE_AMT,0)) AS SALE_SALE_AMT
		    , SUM(NVL(BUY_QTY,0)) AS BUY_QTY
		    , SUM(NVL(RTN_QTY,0)) AS RTN_QTY
		    , SUM(NVL(STRI_QTY,0) - NVL(STRO_QTY,0)) AS STRIO_QTY
		    , SUM(NVL(SALE_QTY,0)) AS SALE_QTY
		    , SUM(NVL(STK_ADJ_SALE_AMT,0)) AS STK_ADJ_SALE_AMT
		    , SUM(NVL(STK_ADJ_QTY,0)) AS STK_ADJ_QTY    
		    , SUM(NVL(BOOK_FWD_SALE,0)) AS BOOK_FWD_SALE
		    , SUM(NVL(BOOK_FWD_QTY,0)) AS BOOK_FWD_QTY
		    , SUM(NVL(FINAL_AMT,0)) AS FINAL_AMT
		    , SUM(NVL(FINAL_QTY,0)) AS FINAL_QTY
		   FROM   TPC_MM_FWD_STK_NEW01 A
		  
			WHERE 	A.STK_DY = replace(#srchStartDate#, '-', '')
				<isEmpty property="srchEntpCode">
					<isNotEmpty  property="venCds"  prepend="AND">
						<iterate prepend="A.VEN_CD IN " property="venCds" open="(" close=")" conjunction=",">
							#venCds[]#
						</iterate>
					</isNotEmpty>
				</isEmpty>
				<isNotEmpty  property="srchEntpCode"  prepend="AND">
					A.VEN_CD = #srchEntpCode#
				</isNotEmpty>
				<isNotEmpty property="srchStoreVal"  prepend="AND">
					<iterate prepend="A.STR_CD IN " property="srchStoreVal" open="(" close=")" conjunction=",">
						#srchStoreVal[]#
					</iterate>
				</isNotEmpty>
				<isNotEmpty  property="srchProductVal"  prepend="AND">
					A.PROD_CD = #srchProductVal#
				</isNotEmpty>
				
		    GROUP BY STR_CD
		  ) MM
		 
		  INNER JOIN STORE C ON MM.STR_CD = C.STR_CD
		  ORDER BY MM.STR_CD
		  
  
		
	</select>
	
	
	
	
	

</sqlMap>
