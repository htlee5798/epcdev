<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="PSCMORD0001">
	<typeAlias alias="dataMap" type="com.lottemart.common.util.DataMap" />
	<typeAlias alias="pscmord0001VO" type="com.lottemart.epc.order.model.PSCMORD0001VO"/>


	<select id="selectAllOnlineStore" resultClass="dataMap">
		  SELECT /* PSCMORD0001.selectAllOnlineStore */
		         STR_CD
		         ,STR_NM
		    FROM TST_STORE 
		   WHERE (ONLINE_YN = 'Y' OR ONLINE_REP_STR_YN = 'Y')
		ORDER BY STR_NM	
	</select>
			
			
	<select id="selectHodevMallStrYn" resultClass="dataMap" parameterClass="pscmord0001VO">
		  SELECT /* PSCMORD0001.selectHodevMallStrYn */ 
		         HODEV_MALL_STR_YN
		    FROM TST_STORE
		   WHERE STR_CD = #strCd#	
	</select>			
			
			
	<select id="selectCodeList" resultClass="dataMap" parameterClass="pscmord0001VO">
		SELECT MINOR_CD, CD_NM FROM TET_CODE WHERE MAJOR_CD = #majorCd#	
	</select>			
			
			
	<select id="selectSearchOrderList" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectSearchOrderList */ 
			SELECT * FROM(
			    SELECT CEIL(ROWNUM / #rowsPerPage#  ) PAGE
			        , ROWNUM AS NUM
			        , COUNT(*) OVER() TOTAL_COUNT
			        , E.* 
			      FROM (
			       SELECT AA.*			          
			             ,(SELECT STR_NM FROM TST_STORE WHERE STR_CD = AA.STR_CD) AS STR_NM
			             <![CDATA[
			             , CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NULL AND SALE_STS_CD IN('11','12','13')
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   ELSE AA.ORG_CUST_NM END AS CUST_NM 
			             ]]>
			       FROM (
					        SELECT DISTINCT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
					            , MAX(O.STR_CD) AS STR_CD
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
								, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
								, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
								, MAX(I.DELIVERY_ID) AS DELIVERY_ID								
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					             ,SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					             ,SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            , ( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            , MAX(TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS ORD_DY
					          	, SUM(I.BUY_PRC*(I.ORD_QTY+I.EXTRA_QTY)) AS BUY_PRC
					          	, O.EC_ORDER_ID
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I					          
					         WHERE 1=1		         
					           AND O.ORDER_ID = I.ORDER_ID
					           AND O.BSKET_TYPE_CD NOT IN ('24','25')
					   		   AND O.ORD_DY BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')
							   <isNotEmpty property="vendorId">
							   AND (0, I.STR_VENDOR_ID)
							   <iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
							      (0, #vendorId[]#)
							   </iterate>
							  </isNotEmpty>   

						<isEqual property="searchOrderType" compareValue="1" >
							   AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							   AND O.EC_ORDER_ID = #orderId#
						</isEqual>    
						<isNotEmpty property="strCd">
							   AND O.STR_CD LIKE #strCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="ordStsCd">
							   AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							   AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							   AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY, O.EC_ORDER_ID	
				      ) AA, TDE_DELI_MST DM
                        WHERE  AA.ORDER_ID = DM.ORDER_ID(+)
                     	   AND AA.DELIVERY_ID = DM.DELIVERY_ID(+) 	      
                     <isNotEmpty property="custNm">
				      	   AND AA.ORG_CUST_NM Like #custNm#||'%'
				     </isNotEmpty>
				      ORDER BY ORD_DY, AA.UP_ORDER_ID, AA.ORDER_ID	
		       )   E				 	 
		)
		WHERE PAGE = #currentPage#
	</select>
	
	<select id="selectSearchOrderListExcel" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectSearchOrderListExcel */ 
			SELECT * FROM(
			    SELECT ROWNUM AS NUM
			        , COUNT(*) OVER() TOTAL_COUNT
			        , E.* 
			      FROM (
			       SELECT AA.*			          
			             ,(SELECT STR_NM FROM TST_STORE WHERE STR_CD = AA.STR_CD) AS STR_NM
			             <![CDATA[
			             , CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NULL AND SALE_STS_CD IN('11','12','13')
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   ELSE AA.ORG_CUST_NM END AS CUST_NM 
			             ]]>
			       FROM (
					        SELECT DISTINCT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
					            , MAX(O.STR_CD) AS STR_CD
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
								, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
								, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
								, MAX(I.DELIVERY_ID) AS DELIVERY_ID								
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					             ,SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					             ,SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            , ( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            , MAX(TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS ORD_DY
					          	, SUM(I.BUY_PRC*(I.ORD_QTY+I.EXTRA_QTY)) AS BUY_PRC
					          	, O.EC_ORDER_ID
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I					          
					         WHERE 1=1		         
					           AND O.ORDER_ID = I.ORDER_ID
					           AND O.BSKET_TYPE_CD NOT IN ('24','25')
					   		   AND O.ORD_DY BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')
							   <isNotEmpty property="vendorId">
							   AND (0, I.STR_VENDOR_ID)
							   <iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
							      (0, #vendorId[]#)
							   </iterate>
							  </isNotEmpty>   

						<isEqual property="searchOrderType" compareValue="1" >
							   AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							   AND O.EC_ORDER_ID = #orderId#
						</isEqual>    
						<isNotEmpty property="strCd">
							   AND O.STR_CD LIKE #strCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="ordStsCd">
							   AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							   AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							   AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY, O.EC_ORDER_ID
				      ) AA, TDE_DELI_MST DM
                        WHERE  AA.ORDER_ID = DM.ORDER_ID(+)
                     	   AND AA.DELIVERY_ID = DM.DELIVERY_ID(+) 	      
                     <isNotEmpty property="custNm">
				      	   AND AA.ORG_CUST_NM Like #custNm#||'%'
				     </isNotEmpty>
				      ORDER BY ORD_DY, AA.UP_ORDER_ID, AA.ORDER_ID	
		       )   E				 	 
		)
	</select>	
	
	<select id="selectSearchSaleList" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectSearchSaleList */ 
			SELECT * FROM(
			    SELECT CEIL(ROWNUM / #rowsPerPage#  ) PAGE
			        , ROWNUM AS NUM
			        , COUNT(*) OVER() TOTAL_COUNT
			        , E.* 
			      FROM (
			       SELECT AA.*			              
			              ,(SELECT STR_NM FROM TST_STORE WHERE STR_CD = AA.STR_CD) AS STR_NM
			              <![CDATA[
			             , CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NULL AND SALE_STS_CD IN('11','12','13')
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   ELSE AA.ORG_CUST_NM END AS CUST_NM 
			             ]]>
			       FROM (
					        SELECT DISTINCT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
					            , MAX(O.STR_CD) AS STR_CD
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
								, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
								, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
								, MAX(I.DELIVERY_ID) AS DELIVERY_ID
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					            , SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					            , SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            , ( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            , MAX(TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS ORD_DY
						   		, MAX(TO_CHAR(TO_DATE(MD.BUSINESSDAYDATE, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS SALE_DY					
								, SUM(I.BUY_PRC*(I.ORD_QTY+I.EXTRA_QTY)) AS BUY_PRC
								, O.EC_ORDER_ID
					          FROM TOR_ORDER O
					          	 , TOR_ORDER_ITEM I
					          	 , TSA_TLOGSELECT MD                              	       
	                       WHERE 1=1					          
					          AND O.ORDER_ID = I.ORDER_ID					         
			   			      AND MD.RECORDQUALIFIER = '5'                              
        	                  AND O.ORDER_ID = MD.ORDER_ID
        	                  AND O.STR_CD = MD.RETAILSTOREID
                              AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ                                                                         
                              AND MD.WORKSTATIONID IN (SELECT POS_NO FROM TET_TLOG_POS WHERE SALE_TYPE IN ('3', '4') AND USE_YN = 'Y')
	                          AND MD.BUSINESSDAYDATE BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')                      
                              AND EXISTS (SELECT 'X' FROM TLOGSEND SS 
	                                          WHERE MD.RETAILSTOREID   = SS.RETAILSTOREID
	                                      		AND MD.BUSINESSDAYDATE = SS.BUSINESSDAYDATE
	                                      		AND MD.WORKSTATIONID   = SS.WORKSTATIONID
	                                       		AND MD.TRANSNUMBER     = SS.TRANSNUMBER
  	                      						AND MD.TRANSTYPECODE   = SS.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
	                                      	    AND SS.TRANSTYPECODE NOT IN ('0050','0060')	/* 20160624 김학수 추가 [현금연수증,LPOINT는 매출에서제외(중복제거)] */
	                                      		AND SS.RESULT_STATUS = 'C')                               
                              AND NOT EXISTS  (SELECT 1 FROM TLOGERR LE 
                                                   WHERE   MD.RETAILSTOREID   = LE.RETAILSTOREID
                                                       AND MD.BUSINESSDAYDATE = LE.BUSINESSDAYDATE
                                                       AND MD.WORKSTATIONID   = LE.WORKSTATIONID                          
                                                       AND MD.TRANSNUMBER     = LE.TRANSNUMBER
                              						   AND MD.TRANSTYPECODE   = LE.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
											  )   
 							  <isNotEmpty property="vendorId">
							  AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
									(0, #vendorId[]#)
								</iterate>
							 </isNotEmpty>   							
           					   AND O.BSKET_TYPE_CD NOT IN ('24','25')   
						<isEqual property="searchOrderType" compareValue="1" >
							   AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							   AND O.EC_ORDER_ID = #orderId#
						</isEqual>      
						<isNotEmpty property="strCd">
							  AND O.STR_CD LIKE #strCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="ordStsCd">
							  AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							  AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							  AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY	, O.EC_ORDER_ID
				      ) AA , TDE_DELI_MST DM
	                   WHERE  AA.ORDER_ID = DM.ORDER_ID(+)
	                   	   AND AA.DELIVERY_ID = DM.DELIVERY_ID(+)   	
	                  <isNotEmpty property="custNm">	  	      
				           AND AA.ORG_CUST_NM Like #custNm#||'%'
				      </isNotEmpty>
					  ORDER BY SALE_DY, AA.UP_ORDER_ID, AA.ORDER_ID 				           
		       )   E
					 
		)
		WHERE PAGE = #currentPage#
	</select>				
		
	<select id="selectSearchSaleListExcel" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectSearchSaleListExcel */ 
			SELECT * FROM(
			    SELECT ROWNUM AS NUM
			        , COUNT(*) OVER() TOTAL_COUNT
			        , E.* 
			      FROM (
			       SELECT AA.*			              
			              ,(SELECT STR_NM FROM TST_STORE WHERE STR_CD = AA.STR_CD) AS STR_NM
			              <![CDATA[
			             , CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -1),'YYYYMMDD') AND DM.DELI_NO IS NULL AND SALE_STS_CD IN('11','12','13')
                                   THEN SUBSTR(AA.ORG_CUST_NM,1,1) || LPAD('*',LENGTH(AA.ORG_CUST_NM)-2,'*') || SUBSTR(AA.ORG_CUST_NM,LENGTH(AA.ORG_CUST_NM),1) 
                                   ELSE AA.ORG_CUST_NM END AS CUST_NM 
			             ]]>
			       FROM (
					        SELECT DISTINCT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
					            , MAX(O.STR_CD) AS STR_CD
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
								, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
								, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
								, MAX(I.DELIVERY_ID) AS DELIVERY_ID
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					            , SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					            , SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            , ( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            , ( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            , MAX(TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS ORD_DY
						   		, MAX(TO_CHAR(TO_DATE(MD.BUSINESSDAYDATE, 'YYYY-MM-DD'),'YYYY-MM-DD')) AS SALE_DY					
								, SUM(I.BUY_PRC*(I.ORD_QTY+I.EXTRA_QTY)) AS BUY_PRC
								, O.EC_ORDER_ID
					          FROM TOR_ORDER O
					          	 , TOR_ORDER_ITEM I
					          	 , TSA_TLOGSELECT MD                              	       
	                       WHERE 1=1					          
					          AND O.ORDER_ID = I.ORDER_ID					         
			   			      AND MD.RECORDQUALIFIER = '5'                              
        	                  AND O.ORDER_ID = MD.ORDER_ID
        	                  AND O.STR_CD = MD.RETAILSTOREID
                              AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ                                                                         
                              AND MD.WORKSTATIONID IN (SELECT POS_NO FROM TET_TLOG_POS WHERE SALE_TYPE IN ('3', '4') AND USE_YN = 'Y')
	                          AND MD.BUSINESSDAYDATE BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')                      
                              AND EXISTS (SELECT 'X' FROM TLOGSEND SS 
	                                          WHERE MD.RETAILSTOREID   = SS.RETAILSTOREID
	                                      		AND MD.BUSINESSDAYDATE = SS.BUSINESSDAYDATE
	                                      		AND MD.WORKSTATIONID   = SS.WORKSTATIONID
	                                       		AND MD.TRANSNUMBER     = SS.TRANSNUMBER
  	                      						AND MD.TRANSTYPECODE   = SS.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
	                                      	    AND SS.TRANSTYPECODE NOT IN ('0050','0060')	/* 20160624 김학수 추가 [현금연수증,LPOINT는 매출에서제외(중복제거)] */
	                                      		AND SS.RESULT_STATUS = 'C')                               
                              AND NOT EXISTS  (SELECT 1 FROM TLOGERR LE 
                                                   WHERE   MD.RETAILSTOREID   = LE.RETAILSTOREID
                                                       AND MD.BUSINESSDAYDATE = LE.BUSINESSDAYDATE
                                                       AND MD.WORKSTATIONID   = LE.WORKSTATIONID                          
                                                       AND MD.TRANSNUMBER     = LE.TRANSNUMBER
                              						   AND MD.TRANSTYPECODE   = LE.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
											  )   
 							  <isNotEmpty property="vendorId">
							  AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
									(0, #vendorId[]#)
								</iterate>
							 </isNotEmpty>   							
           					  AND O.BSKET_TYPE_CD NOT IN ('24','25')   
						<isEqual property="searchOrderType" compareValue="1" >
							AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							AND O.EC_ORDER_ID = #orderId#
						</isEqual>     
						<isNotEmpty property="strCd">
							AND O.STR_CD LIKE #strCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="ordStsCd">
							AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY, O.EC_ORDER_ID	
				      ) AA , TDE_DELI_MST DM
	                   WHERE  AA.ORDER_ID = DM.ORDER_ID(+)
	                   	   AND AA.DELIVERY_ID = DM.DELIVERY_ID(+)   	
	                  <isNotEmpty property="custNm">	  	      
				           AND AA.ORG_CUST_NM Like #custNm#||'%'
				      </isNotEmpty>
					  ORDER BY SALE_DY, AA.UP_ORDER_ID, AA.ORDER_ID 				           
		       )   E			 
		)
	</select>
			
	<select id="selectOrderListBACKUP0512" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectOrderList */ 
			SELECT * FROM(
			    SELECT CEIL(ROWNUM / #rowsPerPage#  ) PAGE
			        , ROWNUM AS NUM
			        , COUNT(*) OVER() TOTAL_COUNT
			        , E.* 
			      FROM (
			       SELECT AA.*
			             ,CASE WHEN SALE_DY_TMP = 'dummy' THEN (
			             										SELECT TO_CHAR(TO_DATE(Z.SALE_DY, 'YYYY-MM-DD'),'YYYY-MM-DD') AS SALE_DY
			                                                    FROM TSA_SALE_HEAD_IMALL Z 
			                                                    WHERE Z.ORDER_ID = AA.ORDER_ID 
			                                                    AND Z.SEND_FG = '1' 
			                                                    AND Z.POS_NO = DECODE(AA.SALE_STS_CD, '01', '8006', '11', '9016')  
			                                                   )
			              ELSE TO_CHAR(TO_DATE(SALE_DY_TMP, 'YYYY-MM-DD'),'YYYY-MM-DD') END AS SALE_DY 
			       FROM (
					        SELECT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
								, MAX(S.STR_NM) AS STR_NM
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
								, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS CUST_NM
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					             ,SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					             ,SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            ,( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            ,TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD') AS ORD_DY
					    <isEqual property="searchType" compareValue="1">
					            ,'dummy' AS SALE_DY_TMP
					            , '' AS BUY_PRC  --  2016.02.16 : MD에 주문원가 받지 않음 by jglee
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I
					          , TST_STORE S
					          , TSA_TLOGSELECT MD
					         WHERE 1=1 
					           AND O.STR_CD = S.STR_CD
					           AND O.ORDER_ID = I.ORDER_ID
                               AND MD.ORDER_ID = O.ORDER_ID
                               AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ
                               AND MD.WORKSTATIONID IN ('8001', '9011')
					           AND O.BSKET_TYPE_CD NOT IN ('24','25')
							   <isNotEmpty property="vendorId">
							   AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
										  (0, #vendorId[]#)
								</iterate>
							   </isNotEmpty>   
			            </isEqual>
					    <isEqual property="searchType" compareValue="2">
								, MAX(SH.SALE_DY) AS SALE_DY_TMP
								, '' AS BUY_PRC
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I
					          , (  SELECT A.ORDER_ID, A.RETAILNUMBER, B.SALE_DY FROM TSA_TLOGSELECT A , TSA_SALE_HEAD_IMALL B
         						    WHERE A.TRANSNUMBER = B.TRD_NO	
                                      AND A.ORDER_ID = B.ORDER_ID
                                      AND A.BUSINESSDAYDATE = B.SALE_DY
                                      AND A.RETAILSTOREID = B.STR_CD
                                      AND A.WORKSTATIONID = B.POS_NO
                                      AND B.POS_NO IN ('8006','9016')
                                     <isNotEmpty property="startDate">
                                      AND A.BUSINESSDAYDATE BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '') 
                                     </isNotEmpty>
                                      AND B.SEND_FG||'' = '1'
                                      AND B.STR_CD = #strCd#
                                 ) SH, TST_STORE S 
                            WHERE O.ORDER_ID = I.ORDER_ID
                              AND I.ORDER_ID = SH.ORDER_ID
                              AND I.ORDER_ITEM_SEQ = SH.ORDER_ITEM_SEQ
                              AND O.STR_CD = S.STR_CD
           					  AND O.BSKET_TYPE_CD NOT IN ('24','25')           					  
							  <isNotEmpty property="vendorId">
							  AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
									(0, #vendorId[]#)
								</iterate>
							  </isNotEmpty>   
						</isEqual>
					   
						<isNotEmpty property="orderId">
							   AND O.UP_ORDER_ID = #orderId#
						</isNotEmpty>     
						<isNotEmpty property="strCd">
							   AND O.STR_CD = #strCd#
							   AND S.STR_CD = #strCd#
						</isNotEmpty>     
						<isNotEmpty property="ordStsCd">
							   AND O.ORD_STS_CD = #ordStsCd#
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							   AND O.SALE_STS_CD = #saleStsCd#
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							   AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY	
				      ) AA where 1=1		      
				        <isNotEmpty property="custNm">
				           AND AA.CUST_NM Like #custNm#||'%'
				    </isNotEmpty>	
		       )   E
				<isEqual property="searchType" compareValue="1">
				 	 ORDER BY ORD_DY	
				</isEqual>
				<isEqual property="searchType" compareValue="2">
					 ORDER BY SALE_DY
				</isEqual>  
		)
		WHERE PAGE = #currentPage#
	</select>
	
	<select id="selectOrderListExcel" resultClass="dataMap" parameterClass="dataMap">
	/* PSCMORD0001.selectOrderListExcel - 20150512 이후부터 사용안함 - 하나로 통합 */ 
			    SELECT  E.* 
			      FROM (
			       SELECT AA.*
			             ,CASE WHEN SALE_DY_TMP = 'dummy' THEN (
			             										SELECT TO_CHAR(TO_DATE(Z.SALE_DY, 'YYYY-MM-DD'),'YYYY-MM-DD') AS SALE_DY
			                                                    FROM TSA_SALE_HEAD_IMALL Z 
			                                                    WHERE Z.ORDER_ID = AA.ORDER_ID 
			                                                    AND Z.SEND_FG = '1' 
			                                                    AND Z.POS_NO = DECODE(AA.SALE_STS_CD, '01', '8006', '11', '9016')  
			                                                   )
			              ELSE TO_CHAR(TO_DATE(SALE_DY_TMP, 'YYYY-MM-DD'),'YYYY-MM-DD') END AS SALE_DY 
			       FROM (  
					        SELECT O.ORDER_ID AS ORDER_ID
					            , MAX(O.UP_ORDER_ID) AS UP_ORDER_ID
								, MAX(S.STR_NM) AS STR_NM
					            , MAX(O.ORD_STS_CD) AS ORD_STS_CD
								, PG_UTIL.FN_GET_CD_NM('OR002', MAX(O.ORD_STS_CD)) AS ORD_STS_NM
					            , MAX(O.SALE_STS_CD) AS SALE_STS_CD 
								, PG_UTIL.FN_GET_CD_NM('OR003', MAX(O.SALE_STS_CD)) AS SALE_STS_NM
					            , (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') CUST_NM
					            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', 0,
					                                   '12', 0,
					                                   '13', 0,
					                                   I.ORD_AMT
					                                 )
					                         ) AS ORDER_ITEM_AMT_SUM
					             ,SUM(  NVL (I.DC_AMT, 0)
					                           + NVL (I.CMS_COUPON_DC_AMT, 0)
					                           + NVL (I.COUPON_DC_AMT, 0)
					                           + NVL (I.STAFF_DC_AMT, 0)
					                  ) AS DC_AMT_SUM
					             ,SUM(DECODE (I.ORD_ITEM_DIVN_CD,
					                                   '11', I.ORD_AMT,
					                                   '12', I.ORD_AMT,
					                                   '13', I.ORD_AMT,
					                                   0
					                           )
					                  ) AS DELIVERY_AMT_SUM
					            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
					            ,( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
					            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
					            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
					            ,TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD') AS ORD_DY
					    <isEqual property="searchType" compareValue="1">
					            ,'dummy' AS SALE_DY_TMP
					            , '' AS BUY_PRC
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I
					          , TST_STORE S
					          , TSA_TLOGSELECT MD
					         WHERE 1=1 
					           AND O.STR_CD = S.STR_CD
					           AND O.ORDER_ID = I.ORDER_ID
					           AND MD.ORDER_ID = O.ORDER_ID
                               AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ
                               AND MD.WORKSTATIONID IN ('8001', '9011')      
					           AND O.BSKET_TYPE_CD NOT IN ('24','25')
							   <isNotEmpty property="vendorId">
							   AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
									(0, #vendorId[]#)
								</iterate>
							   </isNotEmpty>   
			            </isEqual>
					    <isEqual property="searchType" compareValue="2">
								, MAX(SH.SALE_DY) AS SALE_DY_TMP
								, '' AS BUY_PRC
								, O.EC_ORDER_ID
					          FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I
					          , (  SELECT A.ORDER_ID, A.ORDER_ITEM_SEQ A.RETAILNUMBER, B.SALE_DY FROM TSA_TLOGSELECT A , TSA_SALE_HEAD_IMALL B         						   
									WHERE A.TRANSNUMBER = B.TRD_NO	
                                      AND A.ORDER_ID = B.ORDER_ID
                                      AND A.BUSINESSDAYDATE = B.SALE_DY
                                      AND A.RETAILSTOREID = B.STR_CD
                                      AND A.WORKSTATIONID = B.POS_NO
                                      AND B.POS_NO IN ('8006','9016')
                                     <isNotEmpty property="startDate">
                                      AND A.BUSINESSDAYDATE BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '') 
                                     </isNotEmpty>
                                      AND B.SEND_FG||'' = '1'
                                      AND B.STR_CD = #strCd#
                                 ) SH, TST_STORE S 
                            WHERE O.ORDER_ID = I.ORDER_ID
                              AND I.ORDER_ID = SH.ORDER_ID
                              AND I.ORDER_ITEM_SEQ = SH.ORDER_ITEM_SEQ
                              AND O.STR_CD = S.STR_CD
           					  AND O.BSKET_TYPE_CD NOT IN ('24','25')           					  
							  <isNotEmpty property="vendorId">
								AND (0, I.STR_VENDOR_ID)
								<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
										  (0,#vendorId[]#)
								</iterate>
							  </isNotEmpty>   
						</isEqual>   
						<isEqual property="searchOrderType" compareValue="1" >
							   AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							   AND O.EC_ORDER_ID = #orderId#
						</isEqual>
						<isNotEmpty property="strCd">
							   AND O.STR_CD = #strCd#
							   AND S.STR_CD = #strCd#
						</isNotEmpty>     
						<isNotEmpty property="ordStsCd">
							   AND O.ORD_STS_CD = #ordStsCd#
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							   AND O.SALE_STS_CD = #saleStsCd#
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							   AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY		      
				      ) AA where 1=1		      
				        <isNotEmpty property="custNm">
				           AND AA.CUST_NM Like #custNm#||'%'
				    </isNotEmpty>	
		       )   E
				<isEqual property="searchType" compareValue="1">
				 	 ORDER BY ORD_DY	
				</isEqual>
				<isEqual property="searchType" compareValue="2">
					 ORDER BY SALE_DY
				</isEqual>  			
	</select>	
	
	
	<select id="selectOrderListExcel20130205BAK" resultClass="dataMap" parameterClass="dataMap">
		/* PSCMORD0001.selectOrderListExcel20130205BAK */ 
	        SELECT O.ORDER_ID
	            , O.UP_ORDER_ID
	            , O.STR_CD
	            , (SELECT STR_NM FROM TST_STORE WHERE STR_CD = O.STR_CD) STR_NM
	            , O.ORD_STS_CD
	            , (SELECT CD_NM FROM TET_CODE WHERE MAJOR_CD = 'OR002' AND MINOR_CD = O.ORD_STS_CD) AS ORD_STS_NM
	            , O.SALE_STS_CD
	            , (SELECT CD_NM FROM TET_CODE WHERE MAJOR_CD = 'OR003' AND MINOR_CD = O.SALE_STS_CD) AS SALE_STS_NM
	            , DE.CUST_NM
	            , SUM (DECODE (I.ORD_ITEM_DIVN_CD,
	                                   '11', 0,
	                                   '12', 0,
	                                   '13', 0,
	                                   I.ORD_AMT
	                                 )
	                         ) AS ORDER_ITEM_AMT_SUM
	             ,SUM (  NVL (I.DC_AMT, 0)
	                           + NVL (I.CMS_COUPON_DC_AMT, 0)
	                           + NVL (I.COUPON_DC_AMT, 0)
	                           + NVL (I.STAFF_DC_AMT, 0)
	                  ) AS DC_AMT_SUM
	             ,SUM (DECODE (I.ORD_ITEM_DIVN_CD,
	                                   '11', I.ORD_AMT,
	                                   '12', I.ORD_AMT,
	                                   '13', I.ORD_AMT,
	                                   0
	                           )
	                  ) AS DELIVERY_AMT_SUM
	            , SUM(I.TOT_SELL_AMT) AS APPLY_TOT_AMT
	            ,( SELECT max(CD_NM) FROM TET_CODE C, TOR_DEMAND D WHERE D.ORDER_ID = O.ORDER_ID AND C.MAJOR_CD='OR008' AND D.SETL_TYPE_CD = C.MINOR_CD ) AS SETL_TYPE_NM
	            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '04' ) AS APPLY_OCUR_POINT
	            ,( SELECT NVL(SUM(NVL(DPST_AMT, 0)+NVL(SIN_DC, 0)), 0) FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = '03' ) AS APPLY_COUPON_AMT
	            ,TO_CHAR(TO_DATE(O.ORD_DY, 'YYYY-MM-DD'),'YYYY-MM-DD') AS ORD_DY                                                 
	          FROM TOR_ORDER O, TDE_ORDER_DELIVERY DE, TOR_ORDER_ITEM I
	         WHERE O.ORDER_ID = DE.ORDER_ID
	           AND O.ORDER_ID = I.ORDER_ID
	           AND DE.DELIVERY_ID = I.DELIVERY_ID
	           AND O.BSKET_TYPE_CD NOT IN ('24','25')
	           AND O.ORD_DY BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')
		<isNotEmpty property="vendorId">
	           AND (0, I.STR_VENDOR_ID )
	    	<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
	    	          (0, #vendorId[]#)
	    	</iterate>
	    </isNotEmpty>     
		<isNotEmpty property="orderId">
	           AND O.UP_ORDER_ID = #orderId#
	    </isNotEmpty>     
		<isNotEmpty property="strCd">
	           AND O.STR_CD = #strCd#
	    </isNotEmpty>     
	    <isNotEmpty property="ordStsCd">
	           AND O.ORD_STS_CD = #ordStsCd#
	    </isNotEmpty>
	    <isNotEmpty property="saleStsCd">
	           AND O.SALE_STS_CD = #saleStsCd#
	    </isNotEmpty>
	    <isNotEmpty property="setlTypeCd">
	           AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
	    </isNotEmpty>			    
	    <isNotEmpty property="custNm">
	           AND DE.CUST_NM Like #custNm#||'%'
	    </isNotEmpty>			    
	      GROUP BY O.ORDER_ID, O.UP_ORDER_ID, O.STR_CD, O.ORD_STS_CD, O.SALE_STS_CD, DE.CUST_NM, O.ORD_DY
          ORDER BY UP_ORDER_ID, ORDER_ID						
	</select>	
	
	<select id="selectCustInfoList" resultClass="java.lang.String">
	/*PSCMORD0001.selectCustInfoList */
	SELECT NVL(SUM(CUST_NM), 0) AS STATUS  
 		FROM (SELECT  
         <![CDATA[ CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -6),'YYYYMMDD') AND DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
                               THEN '1' 
                               WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -6),'YYYYMMDD') AND DELI_NO IS NULL  AND SALE_STS_CD IN('11','12','13')
                               THEN '1'
                               ELSE '0' END AS CUST_NM    
              ]]>                  
			FROM ( SELECT  /*+ leading(I O MD) INDEX(O IX_OR_ORDER_11) USE_NL(MD)*/O.ORDER_ID
						, MAX(I.DELIVERY_ID) AS DELIVERY_ID
						, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
						, O.SALE_STS_CD 
						, O.ORD_DY
						, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
					        FROM    TOR_ORDER O
						          , TOR_ORDER_ITEM I
						          , TSA_TLOGSELECT MD
						         WHERE 1=1 
						           AND O.ORDER_ID = I.ORDER_ID
					               AND MD.RECORDQUALIFIER = '5'
					               AND MD.ORDER_ID = O.ORDER_ID
					               AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ
					               AND O.STR_CD = MD.RETAILSTOREID
					               AND MD.WORKSTATIONID IN (SELECT /*+NO_UNNEST INDEX(TET_TLOG_POS IX_TET_TLOG_POS_01)*/ POS_NO FROM TET_TLOG_POS WHERE SALE_TYPE IN ('1', '2') AND USE_YN = 'Y') 
						           AND O.BSKET_TYPE_CD NOT IN ('24','25')
						   		   AND O.ORD_DY BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')
					   		       AND EXISTS (SELECT /*+ no_unnest */ 'X' FROM TLOGSEND SS 
					                                          WHERE MD.RETAILSTOREID   = SS.RETAILSTOREID
					                                      		AND MD.BUSINESSDAYDATE = SS.BUSINESSDAYDATE
					                                      		AND MD.WORKSTATIONID   = SS.WORKSTATIONID
					                                      		AND MD.TRANSNUMBER     = SS.TRANSNUMBER
  					                                      		AND MD.TRANSTYPECODE   = SS.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
					                                      		AND SS.TRANSTYPECODE NOT IN ('0050','0060')	/* 20160624 김학수 추가 [현금연수증,LPOINT는 매출에서제외(중복제거)] */
					                                      		AND SS.RESULT_STATUS = 'C')                               
					               AND NOT EXISTS  (SELECT /*+ no_unnest */ 1 FROM TLOGERR LE 
					                                   WHERE   MD.RETAILSTOREID   = LE.RETAILSTOREID
					                                       AND MD.BUSINESSDAYDATE = LE.BUSINESSDAYDATE
					                                       AND MD.WORKSTATIONID   = LE.WORKSTATIONID
					                                       AND MD.TRANSNUMBER     = LE.TRANSNUMBER
  					                                       AND MD.TRANSTYPECODE   = LE.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
													)   
								 <isNotEmpty property="vendorId">
								   AND (0, I.STR_VENDOR_ID)
									<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
											  (0, #vendorId[]#)
									</iterate>
								 </isNotEmpty>   								
								 <isEqual property="searchOrderType" compareValue="1" >
									AND O.UP_ORDER_ID = #orderId#
								 </isEqual>
								 <isEqual property="searchOrderType" compareValue="2" >
									AND O.EC_ORDER_ID = #orderId#
								 </isEqual>    
								 <isNotEmpty property="strCd">
								 	AND O.STR_CD LIKE #strCd# || '%'
								 </isNotEmpty>
								 <isNotEmpty property="ordStsCd">
								    AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
								 </isNotEmpty>
								 <isNotEmpty property="saleStsCd">
								    AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
								 </isNotEmpty>
								 <isNotEmpty property="setlTypeCd">
								    AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
								 </isNotEmpty>		
					      GROUP BY O.ORDER_ID, O.ORD_DY, O.SALE_STS_CD	
					      ) AA, TDE_DELI_MST DM
						 	WHERE AA.ORDER_ID = DM.ORDER_ID (+)
						   	   AND AA.DELIVERY_ID = DM.DELIVERY_ID (+)	      
						  <isNotEmpty property="custNm">
					           AND AA.ORG_CUST_NM Like #custNm#||'%'
					      </isNotEmpty>
		    )					       
	</select>
	
	<select id="selectCustInfoListForSale" resultClass="java.lang.String">
		/*PSCMORD0001."selectCustInfoListForSale" */
		SELECT NVL(SUM(CUST_NM), 0) AS STATUS  
	 		FROM (SELECT  
	         <![CDATA[ CASE WHEN SUBSTR(DM.DELI_FNSH_DATE, 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -6),'YYYYMMDD') AND DELI_NO IS NOT NULL AND AA.DELI_STATUS_CD ='51'
	                               THEN '1' 
	                               WHEN SUBSTR(TO_CHAR(TO_DATE(AA.ORD_DY, 'YYYY-MM-DD'),'YYYYMMDD'), 0, 8) < TO_CHAR(ADD_MONTHS(CURRENT_TIMESTAMP(0), -6),'YYYYMMDD') AND DELI_NO IS NULL  AND SALE_STS_CD IN('11','12','13')
	                               THEN '1'
	                               ELSE '0' END AS CUST_NM    
	              ]]>                  
				FROM( SELECT  O.ORDER_ID
							, MAX(I.DELIVERY_ID) AS DELIVERY_ID
							, MAX(I.DELI_STATUS_CD) AS DELI_STATUS_CD
							, O.SALE_STS_CD 
							, O.ORD_DY
							, (SELECT CUST_NM FROM TDE_ORDER_DELIVERY WHERE ORDER_ID = O.ORDER_ID AND DELIVERY_ID='000') AS ORG_CUST_NM
					       FROM TOR_ORDER O
					          , TOR_ORDER_ITEM I
					          , TSA_TLOGSELECT MD					          
                            WHERE O.ORDER_ID = I.ORDER_ID
                           	   AND O.ORDER_ID = I.ORDER_ID
				               AND MD.RECORDQUALIFIER = '5'
				               AND MD.ORDER_ID = O.ORDER_ID
				               AND MD.ORDER_ITEM_SEQ = I.ORDER_ITEM_SEQ
				               AND O.STR_CD = MD.RETAILSTOREID
				               AND MD.WORKSTATIONID IN (SELECT POS_NO FROM TET_TLOG_POS WHERE SALE_TYPE IN ('3', '4') AND USE_YN = 'Y')				               
					           AND O.BSKET_TYPE_CD NOT IN ('24','25')
					   		   AND MD.BUSINESSDAYDATE BETWEEN REPLACE(#startDate#, '-', '') AND REPLACE(#endDate#, '-', '')
				   		       AND EXISTS (SELECT 'X' FROM TLOGSEND SS 
				                                          WHERE MD.RETAILSTOREID   = SS.RETAILSTOREID
				                                      		AND MD.BUSINESSDAYDATE = SS.BUSINESSDAYDATE
				                                      		AND MD.WORKSTATIONID   = SS.WORKSTATIONID
				                                      		AND MD.TRANSNUMBER     = SS.TRANSNUMBER
  				                                      		AND MD.TRANSTYPECODE   = SS.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
				                                      		AND SS.TRANSTYPECODE NOT IN ('0050','0060')	/* 20160624 김학수 추가 [현금연수증,LPOINT는 매출에서제외(중복제거)] */
				                                      		AND SS.RESULT_STATUS = 'C')                               
				               AND NOT EXISTS  (SELECT 1 FROM TLOGERR LE 
				                                   WHERE   MD.RETAILSTOREID   = LE.RETAILSTOREID
				                                       AND MD.BUSINESSDAYDATE = LE.BUSINESSDAYDATE
				                                       AND MD.WORKSTATIONID   = LE.WORKSTATIONID				                                       
				                                       AND MD.TRANSNUMBER     = LE.TRANSNUMBER
  				                                       AND MD.TRANSTYPECODE   = LE.TRANSTYPECODE	/* tr전송시 lpoint에러로 인해 재전송을 할 경우 중복 에러를 해결하기위해 key추가 */
												)                                         
								<isNotEmpty property="vendorId">
									AND (0, I.STR_VENDOR_ID)
									<iterate prepend="IN" property="vendorId" open="(" close=")" conjunction=",">
										(0, #vendorId[]#)
									</iterate>
								</isNotEmpty>   
           					  AND O.BSKET_TYPE_CD NOT IN ('24','25')   
						<isEqual property="searchOrderType" compareValue="1" >
							AND O.UP_ORDER_ID = #orderId#
						</isEqual>
						<isEqual property="searchOrderType" compareValue="2" >
							AND O.EC_ORDER_ID = #orderId#
						</isEqual>    
						<isNotEmpty property="strCd">
							AND O.STR_CD LIKE #strCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="ordStsCd">
							AND O.ORD_STS_CD LIKE #ordStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="saleStsCd">
							AND O.SALE_STS_CD LIKE #saleStsCd# || '%'
						</isNotEmpty>
						<isNotEmpty property="setlTypeCd">
							AND EXISTS ( SELECT 1 FROM TOR_DEMAND WHERE ORDER_ID = O.ORDER_ID AND SETL_TYPE_CD = #setlTypeCd# LIMIT 1 )
						</isNotEmpty>		
				      GROUP BY O.ORDER_ID, O.ORD_DY, O.SALE_STS_CD	
				      ) AA , TDE_DELI_MST DM
				 		WHERE AA.ORDER_ID = DM.ORDER_ID (+)
				   		   AND AA.DELIVERY_ID = DM.DELIVERY_ID (+)	     
				   		 <isNotEmpty property="custNm">
				           AND AA.ORG_CUST_NM Like #custNm#||'%'
				         </isNotEmpty>
			)				         
	</select>
</sqlMap>