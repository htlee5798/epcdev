<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMORD0030">
	
	<!-- 전표상세 쿼리-->
	<typeAlias alias="NEDMORD0030VO"		type="com.lottemart.epc.edi.order.model.NEDMORD0030VO"/>
	<resultMap id="NEDMORD0030VOMap" class="NEDMORD0030VO">
		<result property="ordSlipNo"			column="ORD_SLIP_NO"		/>	<!-- 발주전표번호 -->
		<result property="prodCd"				column="PROD_CD"			/>	<!-- 상품코드 -->
		<result property="ordFg"				column="ORD_FG"				/>	<!-- 발주구분 -->
		<result property="ordDy"				column="ORD_DY"				/>	<!-- 발주일자 -->
		<result property="strNm"				column="STR_NM"				/>	<!-- 점포명 -->
		<result property="totQty"				column="TOT_QTY"			/>	<!-- 발주총수량 -->
		<result property="totPrc"				column="TOT_PRC"			/>	<!-- 발주총금액 -->
		<result property="ctrArrDy"				column="CTR_ARR_DY"			/>	<!-- 센터입하일자 -->
		<!-- <result property="splyTm"			column="SPLY_TM"/> -->
		<result property="splyDy"				column="SPLY_DY"			/>	<!-- 납품일자 -->
		<result property="userHit"				column="USER_HIT"			/>	<!-- 사용자조회일시 -->
		<result property="venCd"				column="VEN_CD"				/>	<!-- 협력업체코드 -->
		<result property="strCd"				column="STR_CD"				/>	<!-- 점포코드 -->
		<result property="prodPatFg"			column="PROD_PAT_FG"		/>	<!-- 상품패턴구분 -->
		<!-- <result property="logiCatNm"			column="LOGI_CAT_NM"/> -->
		<result property="routeFg"				column="ROUTE_FG"			/>	<!-- 루트구분 -->
		<result property="supplyCd"				column="SUPPLY_CD"			/>	<!-- 통합발주납품처코드 -->
		<result property="supplyNm"				column="SUPPLY_NM"			/>	<!-- 통합발주납품처명 -->
		<result property="srcmkCd"				column="SRCMK_CD"			/>	<!-- 판매코드 -->
		<result property="prodNm"				column="PROD_NM"			/>	<!-- 상품명 -->
		<result property="ordIpsu"				column="ORD_IPSU"			/>	<!-- 발주입수 -->
		<result property="prodStd"				column="PROD_STD"			/>	<!-- 상품규격 -->
		<result property="ordQty"				column="ORD_QTY"			/>	<!-- 발주수량 -->
		<result property="buyPrc"				column="BUY_PRC"			/>	<!-- 원가 -->
		<result property="ordUnit"				column="ORD_UNIT"			/>	<!-- 발주단위 -->
		<result property="splyAbleQty"			column="SPLY_ABLE_QTY"		/>	<!-- 발주가능수량 -->
		<result property="protectTagFg"			column="PROTECT_TAG_FG"		/>	<!-- 도난방지태그여부 -->
		<result property="homeNm"				column="HOME_NM"			/>	<!-- 원산지명 -->
		<result property="taxVat"				column="TAX_VAT"			/>	<!-- VAT -->
		<result property="buyDan"				column="BUY_DAN"			/>	<!-- 상품매입단가 -->
		<result property="evtCd"				column="EVT_CD"				/>	<!-- 행사코드 -->
		<result property="negoBuyPrc"			column="NEGO_BUY_PRC"		/>	<!-- 협상원가 -->
		<result property="producer"				column="PRODUCER"			/>	<!-- 원산지명 -->
		<result property="purUnitCdNm"			column="PUR_UNIT_CD_NM"		/>	<!-- 발주단위명 -->
		<result property="ctrNm"				column="CTR_NM"				/>	<!-- 입고처명 - 센터코드명 -->
	</resultMap>
	
	<select id="TSC_JUNPYO_DETAIL-SELECT01" resultMap="NEDMORD0030VOMap" parameterClass="NEDMORD0030VO">
		/* NEDMORD0030.TSC_JUNPYO_DETAIL-SELECT01 */
		SELECT 	/*+ index (A IX_TPC_ORD_04) */
				A.ORD_SLIP_NO
			,	B.PROD_CD
			,	A.ORD_FG
			,	TO_CHAR(TO_DATE(A.ORD_DY,'yyyymmdd'),'YYYY-MM-DD') AS ORD_DY
			--,	D.STR_NM
			, CASE WHEN TRANSLATE(SUBSTR(A.STR_CD, 1, 1), '0123456789'||SUBSTR(A.STR_CD, 1, 1), '0123456789') IS NULL THEN '각 점포'
					ELSE D.STR_NM END AS STR_NM
			,	A.TOT_QTY
			,	A.TOT_PRC
			,	TO_CHAR(TO_DATE(A.CTR_ARR_DY,'yyyymmdd'),'YYYY-MM-DD') AS CTR_ARR_DY
			--,	A.SPLY_TM
			,	TO_CHAR(TO_DATE(A.SPLY_DY,'yyyymmdd'),'YYYY-MM-DD') SPLY_DY
			,	DECODE(A.USER_HIT_DT,NULL,'N','Y') AS USER_HIT
			,	A.VEN_CD
			,	A.STR_CD
			,	A.PROD_PAT_FG
			--,	A.LOGI_CAT_NM
			,	A.ROUTE_FG
			,	DECODE(A.ORD_FG,'4',A.SUPPLY_CD,A.CTR_CD) AS SUPPLY_CD
			,	DECODE(A.ORD_FG,'4',A.SUPPLY_NM,D.STR_NM) AS SUPPLY_NM
			,	B.SRCMK_CD
			,	B.PROD_NM
			,	B.ORD_IPSU
			,	B.PROD_STD
			,	B.ORD_QTY
			,	B.BUY_PRC
			,	C2.MINOR_CD AS ORD_UNIT
			,	B.SPLY_ABLE_QTY
			,	DECODE(B.PROTECT_TAG_FG,'9','Y','') AS PROTECT_TAG_FG
			,	B.HOME_NM
			,	DECODE(B.TAX_FG,'2',BUY_PRC,'0') AS TAX_VAT
			,	B.BUY_DAN
			,	B.EVT_CD
			,	B.NEGO_BUY_PRC
			,	B.PRODUCER
			,	C2.CD_NM AS PUR_UNIT_CD_NM
			,	A.CTR_CD
			, 	E.STR_NM AS CTR_NM
		FROM 	TPC_ORD A
				INNER JOIN TPC_ORD_PROD B ON B.PDC_ORD_SLIP_NO IS NULL AND A.ORD_SLIP_NO = B.ORD_SLIP_NO
				LEFT OUTER JOIN TPC_CODE C1 ON C1.MAJOR_CD = 'ORD01' AND C1.MINOR_CD = A.ORD_FG
				LEFT OUTER JOIN TPC_CODE C2 ON C2.MAJOR_CD = 'CSA01' AND C2.MINOR_CD = B.ORD_UNIT
				INNER JOIN STORE D ON A.STR_CD = D.STR_CD
				INNER JOIN STORE E ON A.CTR_CD = E.STR_CD
		WHERE 	A.PDC_ORD_SLIP_NO IS NULL  OR A.PDC_ORD_SLIP_NO = ''
			AND A.ORD_DY BETWEEN replace(#srchStartDate#,'-','') and replace(#srchEndDate#,'-','')
			
			<isEmpty property="searchEntpCd">
				<isNotEmpty property="venCds" prepend="AND">
					<iterate prepend="A.VEN_CD IN " property="venCds" open="(" close=")" conjunction=",">
						#venCds[]#
					</iterate>
				</isNotEmpty>
			</isEmpty>
			
			<isNotEmpty prepend="AND" property="searchEntpCd">
				A.VEN_CD = #searchEntpCd#
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="searchStoreAl">
				<iterate prepend="B.STR_CD IN " property="searchStoreAl" open="(" close=")" conjunction=",">
					#searchStoreAl[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="searchProductVal">
				B.PROD_CD = #searchProductVal#
			</isNotEmpty>
			
			<isNotEmpty property="searchOrdering">
				<isNotEqual property="searchOrdering" compareValue="ALL">
					AND A.ORD_FG = #searchOrdering#
				</isNotEqual>
			</isNotEmpty>
			
		ORDER BY A.ORD_SLIP_NO, B.PROD_CD
	</select>

</sqlMap>
