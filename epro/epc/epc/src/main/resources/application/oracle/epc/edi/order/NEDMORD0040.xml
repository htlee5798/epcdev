<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMORD0040">

	<!-- 점포별 쿼리-->
	<typeAlias alias="NEDMORD0040VO"		type="com.lottemart.epc.edi.order.model.NEDMORD0040VO"/>
	
	<resultMap id="NEDMORD0040VOMap" class="NEDMORD0040VO">
		<result property="prodCd"				column="PROD_CD"			/>	<!-- 상품코드 -->
		<result property="srcmkCd"				column="SRCMK_CD"			/>	<!-- 판매코드 -->
		<result property="prodNm"				column="PROD_NM"			/>	<!-- 상품명 -->
		<result property="prodStd"				column="PROD_STD"			/>	<!-- 상품규격 -->
		<result property="ordUnit"				column="ORD_UNIT"			/>	<!-- 발주단위 -->
		<result property="ordIpsu"				column="ORD_IPSU"			/>	<!-- 발주입수 -->
		<result property="buyDan"				column="BUY_DAN"			/>	<!-- 상품매입단가 -->
		<result property="strNm"				column="STR_NM"				/>	<!-- 점포명 -->
		<result property="ordQty"				column="ORD_QTY"			/>	<!-- 발주수량 -->
		<result property="buyPrc"				column="BUY_PRC"			/>	<!-- 원가 -->
		<result property="negoBuyPrc"			column="NEGO_BUY_PRC"		/>	<!-- 협상원가 -->
		<result property="homeNm"				column="HOME_NM"			/>	<!-- 원산지명 -->
		<result property="ordSlipNo"			column="ORD_SLIP_NO"		/>	<!-- 발주전표번호 -->
		<result property="splyAbleQty"			column="SPLY_ABLE_QTY"		/>	<!-- 점포코드 -->
		<result property="strCd"				column="STR_CD"				/>	<!-- 점포코드 -->
		<result property="producer"				column="PRODUCER"			/>	<!-- 원산지명 -->
		<result property="purUnitCdNm"			column="PUR_UNIT_CD_NM"		/>	<!-- 발주단위명 -->
	</resultMap>
	
	<select id="TSC_STORE-SELECT01" resultMap="NEDMORD0040VOMap" parameterClass="NEDMORD0040VO">
		/* NEDMORD0040.TSC_STORE-SELECT01 */
		SELECT 	/*+index(A IX_TPC_ORD_PROD_2)*/
				A.PROD_CD
			,	A.SRCMK_CD
			,	A.PROD_NM
			,	A.PROD_STD
			,	A.ORD_UNIT
			,	A.ORD_IPSU
			,	SUM(A.BUY_DAN) AS BUY_DAN
			,	B.STR_NM AS STR_NM
			,	SUM(A.ORD_QTY) AS ORD_QTY
			,	SUM(A.BUY_PRC) AS BUY_PRC
			,	A.NEGO_BUY_PRC
			,	A.HOME_NM
			,	A.ORD_SLIP_NO
			,	SUM(A.SPLY_ABLE_QTY) AS SPLY_ABLE_QTY
			,	A.STR_CD
			,	A.PRODUCER
			,	C1.CD_NM AS PUR_UNIT_CD_NM
		FROM 	TPC_ORD_PROD A
				LEFT OUTER JOIN TPC_CODE C1 ON C1.MINOR_CD = A.ORD_UNIT AND C1.MAJOR_CD = 'CSA01'
				INNER JOIN STORE B ON A.STR_CD = B.STR_CD
		WHERE	A.PDC_ORD_SLIP_NO IS NULL
			AND A.ORD_DY BETWEEN replace(#srchStartDate#,'-','') and replace(#srchEndDate#,'-','')
			
			<isEmpty property="searchEntpCd">
				<isNotEmpty  property="venCds"  prepend="AND">
					<iterate prepend="A.VEN_CD IN " property="venCds" open="(" close=")" conjunction=",">
						#venCds[]#
					</iterate>
				</isNotEmpty>
			</isEmpty>
			
			<isNotEmpty prepend="AND" property="searchEntpCd">
				A.VEN_CD = #searchEntpCd#
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="searchStoreAl">
				<iterate prepend="B.STR_CD IN " property="searchStoreAl" open="(" close=")" conjunction=",">
					#searchStoreAl[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="searchProductVal">
				A.PROD_CD = #searchProductVal#
			</isNotEmpty>
			
		GROUP BY 	A.PROD_CD
				,	A.SRCMK_CD
				,	A.PROD_NM
				,	A.PROD_STD
				,	A.ORD_UNIT
				,	A.ORD_IPSU
				,	A.BUY_DAN
				,	B.STR_NM
				,	A.NEGO_BUY_PRC
				,	A.HOME_NM
				,	A.ORD_SLIP_NO
				,	A.STR_CD
				,	A.PRODUCER
				,	C1.CD_NM
		ORDER BY A.PROD_CD, A.STR_CD
	</select>

</sqlMap>
