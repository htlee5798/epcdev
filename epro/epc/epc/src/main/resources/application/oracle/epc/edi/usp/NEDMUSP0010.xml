<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMUSP0010">

	<typeAlias alias="NEDMUSP0010VO"		type="com.lottemart.epc.edi.usply.model.NEDMUSP0010VO"/>

	<!-- 일자별 -->
	<resultMap id="NEDMUSP0010VOMap" class="NEDMUSP0010VO">
	 	<result property="splyDy"			column="SPLY_DY"		/>	<!-- 납품일 -->
	 	<result property="ordQty"			column="ORD_QTY"		/>	<!-- 발주수량 -->
	 	<result property="ordBuyAmt"		column="ORD_BUY_AMT"	/>	<!-- 발주원가금액 -->
	 	<result property="buyQty"			column="BUY_QTY"		/>	<!-- 매입수량 -->
	 	<result property="buyBuyAmt"		column="BUY_BUY_AMT"	/>	<!-- 매입원가금액 -->
	 	<result property="usplyQty"			column="USPLY_QTY"		/>	<!-- 미압수량 -->
	 	<result property="usplyBuyAmt"		column="USPLY_BUY_AMT"	/>	<!-- 미납원가금액 -->
	 	<result property="usplyRatio"		column="USPLY_RATIO"	/>	<!-- 미납률 -->
	</resultMap> 

	<select id="TSC_DAY-SELECT01" resultMap="NEDMUSP0010VOMap" parameterClass="NEDMUSP0010VO">
		/* NEDMUSP0010.TSC_DAY-SELECT01 */
		SELECT	TO_CHAR(TO_DATE(SPLY_DY,'yyyymmdd'),'YYYY-MM-DD') SPLY_DY
			,	SUM(NVL(ORD_QTY, 0))	AS ORD_QTY
			,	SUM(ORD_BUY_AMT) 		AS ORD_BUY_AMT
			,	SUM(NVL(BUY_QTY,0)) 	AS BUY_QTY
			,	SUM(BUY_BUY_AMT) 		AS BUY_BUY_AMT
			,	SUM(NVL(USPLY_QTY,0)) 	AS USPLY_QTY
			,	SUM(USPLY_BUY_AMT) 		AS USPLY_BUY_AMT
			,	TO_CHAR( ROUND (SUM(USPLY_BUY_AMT) / ( DECODE(SUM(ORD_BUY_AMT),0,1,SUM(ORD_BUY_AMT)) ) * 100 , 1) ) AS USPLY_RATIO	
		FROM  	TPC_USPLY_PROD	
		WHERE 	SPLY_DY BETWEEN replace(#srchStartDate#,'-','') and replace(#srchEndDate#,'-','')
			<isEmpty property="searchEntpCd">
				<isNotEmpty  property="venCds"  prepend="AND">
					<iterate prepend="VEN_CD IN " property="venCds" open="(" close=")" conjunction=",">
						#venCds[]#
					</iterate>
				</isNotEmpty>
			</isEmpty>
			
			<isNotEmpty  property="searchEntpCd"  prepend="AND">
				VEN_CD = #searchEntpCd#
			</isNotEmpty>
			
			<isNotEmpty property="searchStoreAl"  prepend="AND">
				<iterate prepend="STR_CD IN " property="searchStoreAl" open="(" close=")" conjunction=",">
					#searchStoreAl[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty  property="searchProductVal"  prepend="AND">
				PROD_CD = #searchProductVal#
			</isNotEmpty>
		
		GROUP BY SPLY_DY
		ORDER BY SPLY_DY
	</select>
	
</sqlMap>
