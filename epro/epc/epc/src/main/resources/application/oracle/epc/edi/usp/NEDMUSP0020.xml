<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="NEDMUSP0020">

	<typeAlias alias="NEDMUSP0020VO"		type="com.lottemart.epc.edi.usply.model.NEDMUSP0020VO"/>
	
	<!-- 점포별 -->
	<resultMap id="NEDMUSP0020VOMap" class="NEDMUSP0020VO">
	 	<result property="splyDy"			column="SPLY_DY"		/>	<!-- 납품일 -->
	 	<result property="strNm"			column="STR_NM"			/>	<!-- 점포명 -->
	 	<result property="ordQty"			column="ORD_QTY"		/>	<!-- 발주수량 -->
	 	<result property="ordBuyAmt"		column="ORD_BUY_AMT"	/>	<!-- 발주원가금액 -->
	 	<result property="buyQty"			column="BUY_QTY"		/>	<!-- 매입수량 -->
	 	<result property="buyBuyAmt"		column="BUY_BUY_AMT"	/>	<!-- 매입원가금액 -->
	 	<result property="usplyQty"			column="USPLY_QTY"		/>	<!-- 미납수량 -->
	 	<result property="usplyBuyAmt"		column="USPLY_BUY_AMT"	/>	<!-- 미납원가금액 -->
	 	<result property="strCd"			column="STR_CD"			/>	<!-- 점포코드 -->
	</resultMap>
	
	<select id="TSC_STORE-SELECT01" resultMap="NEDMUSP0020VOMap" parameterClass="NEDMUSP0020VO">
		/* NEDMUSP0020.TSC_STORE-SELECT01 */
		SELECT	TO_CHAR(TO_DATE(A.SPLY_DY,'yyyymmdd'),'YYYY-MM-DD') SPLY_DY
			,	B.STR_NM
			,	SUM(NVL(A.ORD_QTY,0)) 	AS ORD_QTY
			,	SUM(A.ORD_BUY_AMT) 		AS ORD_BUY_AMT
			,	SUM(NVL(A.BUY_QTY,0)) 	AS BUY_QTY
			,	SUM(A.BUY_BUY_AMT) 		AS BUY_BUY_AMT
			,	SUM(NVL(A.USPLY_QTY,0)) AS USPLY_QTY
			,	SUM(A.USPLY_BUY_AMT) 	AS USPLY_BUY_AMT
			,	A.STR_CD
		FROM  	TPC_USPLY_PROD A
				INNER JOIN STORE B ON A.STR_CD = B.STR_CD
		WHERE 	SPLY_DY BETWEEN replace(#srchStartDate#,'-','') and replace(#srchEndDate#,'-','')
			<isEmpty property="searchEntpCd">
				<isNotEmpty  property="venCds"  prepend="AND">
					<iterate prepend="A.VEN_CD IN " property="venCds" open="(" close=")" conjunction=",">
						#venCds[]#
					</iterate>
				</isNotEmpty>
			</isEmpty>
			
			<isNotEmpty  property="searchEntpCd"  prepend="AND">
				A.VEN_CD = #searchEntpCd#
			</isNotEmpty>
			
			<isNotEmpty property="searchStoreAl"  prepend="AND">
				<iterate prepend="A.STR_CD IN " property="searchStoreAl" open="(" close=")" conjunction=",">
					#searchStoreAl[]#
				</iterate>
			</isNotEmpty>
			
			<isNotEmpty  property="searchProductVal"  prepend="AND">
				A.PROD_CD = #searchProductVal#
			</isNotEmpty>
		
		GROUP BY A.SPLY_DY, B.STR_NM, A.STR_CD
		ORDER BY A.SPLY_DY, A.STR_CD
	</select>
	
</sqlMap>
