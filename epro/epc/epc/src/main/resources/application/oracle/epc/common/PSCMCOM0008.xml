<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">


<sqlMap namespace="PSCMCOM0008">

<typeAlias alias="pSCMCOM0008VO"  type="com.lottemart.epc.common.model.PSCMCOM0008VO" />

	<!-- 업체찾기 공통 selectVendCodeList  -->
	<resultMap id="commonCodeResult" class="pSCMCOM0008VO">
	  		 <result property="venCd"    	  column="VEN_CD"      />	<!--업체코드        -->
	         <result property="venNm"         column="VEN_NM"      />	<!--업체명          -->
	         <result property="bmanNo"        column="BMAN_NO"     />	<!--사업자번호      -->
	         <result property="bmanNoFmt"     column="BMAN_NO_FMT" />	<!--사업자번호 패턴 -->
	         <result property="btyp"          column="BTYP"        />	<!--업태            -->
	         <result property="bkind"         column="BKIND"       />	<!--업종            -->
	         <result property="addr1"         column="ADDR1"       />	<!--주소1          -->
	         <result property="addr2"         column="ADDR2"       />	<!--주소2          -->
	         <result property="repTelNo"      column="REP_TEL_NO"  />	<!--대표전화        -->
	         <result property="presidNm"      column="PRESID_NM"   />	<!--대표자명        -->
	</resultMap> 

	
	<!-- 관계 협력업체 목록 조회  dynamic Where 공통 (selectVendCodeList, selectVendCodeCnt) -->
	<sql id="selectVendCodeList_Where">
	    
	    
	    
	    <isEqual property="findType" compareValue="01"  >
	            INNER JOIN TED_PO_EMP_VENDOR S2 
                        ON S1.TRD_TYP_FG = '2'
                       AND S2.EMP_NO = #empNo#
                       AND S1.VEN_CD = S2.VEN_CD
                		<isNotEmpty property="vendorId" 	prepend="AND" >	
						    S1.VEN_CD LIKE #vendorId# || '%'
						</isNotEmpty>
						<isNotEmpty property="_vendorId"	prepend="AND" >	
						    S1.VEN_CD = #_vendorId#
						</isNotEmpty>
						<isNotEmpty property="vendorNm"		prepend="AND" >		            
						    S1.VEN_NM LIKE '%'|| #vendorNm# ||'%'
						</isNotEmpty>
						<isNotEmpty property="bmanNo"		prepend="AND" >		            
						    S1.BMAN_NO LIKE  #bmanNo# ||'%'
						</isNotEmpty>
		</isEqual>
		<isEqual property="findType" compareValue="02"  >
			    WHERE 1=1	
				<isNotEmpty property="vendorId" 	prepend="AND" >	
				    S1.VEN_CD LIKE #vendorId# || '%'
				</isNotEmpty>
				<isNotEmpty property="_vendorId"	prepend="AND" >	
				    S1.VEN_CD = #_vendorId#
				</isNotEmpty>
				<isNotEmpty property="vendorNm"		prepend="AND" >		            
				    S1.VEN_NM LIKE '%'|| #vendorNm# ||'%'
				</isNotEmpty>
				<isNotEmpty property="bmanNo"		prepend="AND" >		            
					S1.BMAN_NO LIKE  #bmanNo# ||'%'
				</isNotEmpty>
	  	</isEqual>     
	</sql>    
	
	<!-- 관계 협력업체 목록 조회 -->
	<select id="selectVendCodeList"   parameterClass="pSCMCOM0008VO" resultMap="commonCodeResult">
		/*PSCMCOM0008.selectVendCodeList*/
		SELECT *  FROM (
			SELECT ROWNUM RNUM , A.*  FROM (
				 SELECT  M2.VEN_CD        
				        ,M2.VEN_NM      
				        ,M2.BMAN_NO
				        , CASE WHEN M2.BMAN_NO IS NOT NULL and  LENGTH(M2.BMAN_NO) = 10  THEN
                     	       SUBSTR(M2.BMAN_NO,1,3)||'-'||SUBSTR(M2.BMAN_NO,4,2)||'-'||SUBSTR(M2.BMAN_NO,6)
                  		 ELSE  M2.BMAN_NO END AS BMAN_NO_FMT 
                  		,nvl(M2.BTYP,' ') BTYP        
				        ,nvl(M2.BKIND,' ') BKIND       
				        ,M2.ADDR1      
				        ,M2.ADDR2      
				        ,M2.REP_TEL_NO 
				        ,M2.PRESID_NM  
				    FROM ( SELECT S1.VEN_CD    AS VEN_CD
				                 ,MAX(S1.STR_CD) AS STR_CD
				             FROM TED_VENDOR S1
				                    <include refid="PSCMCOM0008.selectVendCodeList_Where"/>			                       
				                GROUP BY S1.VEN_CD        
				         ) M1 
				   INNER JOIN TED_VENDOR M2 
				           ON M1.VEN_CD = M2.VEN_CD 
				          AND M1.STR_CD = M2.STR_CD
				    WHERE M2.TRD_TYP_FG = '2'      
				ORDER BY M2.VEN_NM
			)A )A
		 WHERE RNUM BETWEEN  #startRowNo# AND #endRowNo# 
  	</select>    

	<!-- 관계 협력업체 목록 PAGING 카운트 조회 -->
	<select id="selectVendCodeCnt"   parameterClass="pSCMCOM0008VO"  resultClass="int">
		/*PSCMCOM0008.selectVendCodeCnt*/
	    	SELECT COUNT(*) CNT
	    	  FROM ( SELECT S1.VEN_CD    AS VEN_CD
			                 ,MAX(S1.STR_CD) AS STR_CD
			             FROM TED_VENDOR S1
			                    <include refid="PSCMCOM0008.selectVendCodeList_Where"/>			                       
			                GROUP BY S1.VEN_CD        
			        ) M1 
			   INNER JOIN TED_VENDOR M2 
			           ON M1.VEN_CD = M2.VEN_CD 
			          AND M1.STR_CD = M2.STR_CD
			 WHERE M2.TRD_TYP_FG = '2'          
	</select>


</sqlMap>